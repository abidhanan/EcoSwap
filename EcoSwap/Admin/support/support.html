<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Laporan Pengguna</title>
    <link rel="stylesheet" href="../dashboard/dashboard.css">
    <link rel="stylesheet" href="../support/support.css"> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="sidebar">
        <div class="logo">Admin Ecoswap</div>
        <nav>
            <a href="../dashboard/dashboard.html"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
            <a href="../produk&stok/produk&stok.html"><i class="fas fa-box"></i> Produk & Stok</a>
            <a href="../pengguna/pengguna.html"><i class="fas fa-users"></i> Pengguna</a>
            <a href="../transaksi/transaksi.html"><i class="fas fa-exchange-alt"></i> Transaksi</a>
            <a href="../support/support.html" class="active"><i class="fas fa-comments"></i> Laporan & Support</a>
            <a href="../pengaturan/pengaturan.html"><i class="fas fa-cog"></i> Pengaturan</a>
        </nav>
    </div>

    <div class="main-content">
        <header>
            <h1>Laporan Transaksi</h1>
            <div class="user-info">
                <i class="fas fa-bell notification-icon open-modal-btn"></i>
                <a href="../pengaturan/pengaturan.html" class="profile-btn-header">
                    <img src="../gambar/dimas.jpg" alt="Profil" class="profile-img-header">
                </a>
            </div>
        </header>

        <section class="table-section">
            <div class="card dispute-card">
                <h3>Daftar Sengketa Aktif & Terbaru</h3>
                <table class="data-table dispute-table">
                    <thead>
                        <tr>
                            <th>ID Sengketa</th>
                            <th>ID Transaksi</th>
                            <th>Masalah Utama</th>
                            <th>Pelapor</th>
                            <th>Status</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr data-dispute-id="#DS001" data-trx-id="#TRX2204" data-status="Menunggu Bukti" data-pelapor="Doni P." data-penjual="Toko Gadget" data-klaim="Barang diterima dalam kondisi rusak parah (pecah)." data-bukti-url="../gambar/barang_rusak"
                            data-pelapor-id="DONIP" data-penjual-id="GADGET01">
                            <td>#DS001</td>
                            <td>#TRX2204</td>
                            <td>Barang Rusak Saat Tiba</td>
                            <td>Doni P.</td>
                            <td><span class="status status-warning">Menunggu Tinjauan</span></td>
                            <td>
                                <button class="action-btn process-btn open-dispute-modal"><i class="fas fa-file-alt"></i> Lihat Keluhan</button>
                            </td>
                        </tr>
                        <tr data-dispute-id="#DS002" data-trx-id="#TRX2150" data-status="Sedang Mediasi" data-pelapor="Ria T." data-penjual="Kolektor A" data-klaim="Kondisi barang tidak sesuai dengan deskripsi 9/10 (hanya 6/10)." data-bukti-url="../gambar/bukti/bukti_tidak_sesuai.jpg"
                            data-pelapor-id="RIAT" data-penjual-id="KOLAKOL">
                            <td>#DS002</td>
                            <td>#TRX2150</td>
                            <td>Kondisi Tidak Sesuai</td>
                            <td>Ria T.</td>
                            <td><span class="status status-primary">Sudah Ditinjau</span></td>
                            <td>
                                <button class="action-btn danger-btn open-dispute-modal"><i class="fas fa-gavel"></i> Sudah Ditinjau</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </div>
    
    <div id="disputeModal" class="modal">
        <div class="modal-content large-modal-size">
            <span class="close-btn dispute-close-btn">&times;</span>
                <h2>Detail Sengketa: <span id="disputeModalTrxId"></span></h2>
                
                <div class="dispute-modal-grid">
                    
                    <div class="dispute-col-left">
                        <h3>Klaim & Bukti Pelapor (<span id="disputeModalPelapor"></span>)</h3>
                        <p class="dispute-status-display">Status: <strong id="disputeModalStatus"></strong></p>
                        <p class="dispute-claim-desc"><strong>Klaim:</strong> <span id="disputeModalKlaim"></span></p>
                        
                        <hr>
                        
                        <h4>Bukti Foto/Video:</h4>
                        <div class="evidence-box">
                            <img id="disputeModalEvidence" src="../gambar/barang_rusak.jpg" alt="Bukti Keluhan" class="evidence-img">
                        </div>
                    </div>
                    
                    <div class="dispute-col-right">
                            <h3>Keputusan & Mediasi</h3>
                            <p><strong>ID Sengketa:</strong> <span id="disputeModalId"></span></p>
                            <p><strong>Penjual:</strong> <span id="disputeModalPenjual"></span></p>
                            
                            <hr>
                            
                            <h4 style="color: #FFD700; margin-top: 10px;">Aksi Cepat:</h4>
                            <div class="chat-actions">
                                <button class="action-btn info-btn chat-seller-btn"><i class="fas fa-comment-dots"></i> Chat Penjual</button>
                                <button class="action-btn primary-btn chat-buyer-btn"><i class="fas fa-comment-dots"></i> Chat Pembeli</button>
                            </div>

                            <hr>
                    </div>
            </div>
        </div>
    </div>
    
    <div id="notificationModal" class="modal">
        <div class="modal-content">
            <span class="close-btn notif-close-btn">&times;</span>
            <h2>Notifikasi</h2>
            <p>Tidak ada notifikasi yang siap ditampilkan.</p>
        </div>
    </div>

    <script>
        // Data Dummy untuk Sengketa (Simulasi)
        const dummyDisputeData = {
            "#DS001": { 
                trxId: "#TRX2204", status: "Menunggu Tinjauan", pelapor: "Doni P.", penjual: "Toko Gadget",
                klaim: "Barang diterima dalam kondisi rusak parah (pecah).", buktiUrl: "../gambar/barang_rusak.jog"
            },
            "#DS002": { 
                trxId: "#TRX2150", status: "Sudah Ditinjau", pelapor: "Ria T.", penjual: "Kolektor A",
                klaim: "Kondisi barang tidak sesuai dengan deskripsi 9/10 (hanya 6/10).", buktiUrl: "../gambar/barang_rusak.jpg"
            },
        };

        document.addEventListener('DOMContentLoaded', function() {
            const disputeModal = document.getElementById("disputeModal");
            const notificationModal = document.getElementById("notificationModal");
            const notificationBtn = document.querySelector(".notification-icon");
            const openDisputeButtons = document.querySelectorAll(".open-dispute-modal");

            // Elemen Modal Dispute
            const modalTrxId = document.getElementById("disputeModalTrxId");
            const modalId = document.getElementById("disputeModalId");
            const modalPelapor = document.getElementById("disputeModalPelapor");
            const modalStatus = document.getElementById("disputeModalStatus");
            const modalKlaim = document.getElementById("disputeModalKlaim");
            const modalEvidence = document.getElementById("disputeModalEvidence");
            const modalPenjual = document.getElementById("disputeModalPenjual");

            const disputeCloseBtn = disputeModal ? disputeModal.querySelector(".close-btn") : null;
            const notifCloseBtn = notificationModal ? notificationModal.querySelector(".close-btn") : null;
            
            // --- LOGIC BUKA MODAL NOTIFIKASI ---
            if (notificationBtn && notificationModal) {
                notificationBtn.onclick = function() { notificationModal.style.display = "block"; }
            }
            if (notifCloseBtn) {
                notifCloseBtn.onclick = function() { notificationModal.style.display = "none"; }
            }

            // --- LOGIC BUKA MODAL SENGKETA ---
            openDisputeButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const row = this.closest('tr');
                    const disputeId = row.getAttribute('data-dispute-id');
                    const data = dummyDisputeData[disputeId]; // Ambil data dari dummy object
                    
                    // Ambil ID Chat dari HTML TR
                    const currentSellerId = row.getAttribute('data-penjual-id');
                    const currentBuyerId = row.getAttribute('data-pelapor-id'); 

                    // Isi Modal dengan Data
                    if (modalTrxId) modalTrxId.textContent = data.trxId;
                    if (modalId) modalId.textContent = data.disputeId;
                    if (modalPelapor) modalPelapor.textContent = data.pelapor;
                    if (modalStatus) modalStatus.textContent = data.status;
                    if (modalKlaim) modalKlaim.textContent = data.klaim;
                    if (modalEvidence) modalEvidence.src = data.buktiUrl;
                    if (modalPenjual) modalPenjual.textContent = data.penjual;
                    
                    if (disputeModal) disputeModal.style.display = "block";

                    // Set Event Listeners untuk Tombol Chat di Modal
                    const chatSellerBtn = disputeModal.querySelector(".chat-seller-btn");
                    const chatBuyerBtn = disputeModal.querySelector(".chat-buyer-btn");

                    if (chatSellerBtn) {
                        chatSellerBtn.onclick = function() {
                            alert(`Simulasi: Membuka jendela chat dengan Penjual (${currentSellerId}).`);
                        };
                    }
                    if (chatBuyerBtn) {
                        chatBuyerBtn.onclick = function() {
                            alert(`Simulasi: Membuka jendela chat dengan Pembeli (${currentBuyerId}).`);
                        };
                    }
                });
            });

            // --- LOGIC TUTUP MODAL X ---
            if (disputeCloseBtn) {
                disputeCloseBtn.onclick = function() { disputeModal.style.display = "none"; }
            }

            // --- LOGIC AKSI KEPUTUSAN SENGKETA (Simulasi) ---
            document.querySelectorAll('.action-resolve-full, .action-resolve-partial, .action-resolve-tolak').forEach(button => {
                button.addEventListener('click', function() {
                    const disputeId = document.getElementById("disputeModalId").textContent;
                    let action = 'Memutuskan';
                    
                    if (this.classList.contains('action-resolve-full')) action = 'Mengembalikan Dana Penuh';
                    else if (this.classList.contains('action-resolve-partial')) action = 'Memutuskan Partial Refund';
                    else if (this.classList.contains('action-resolve-tolak')) action = 'Menolak Klaim';
                    
                    alert(`Simulasi: Admin ${action} untuk Sengketa ${disputeId}. Status Escrow telah diperbarui.`);
                    disputeModal.style.display = "none";
                });
            });
            

            // Menutup Modal jika klik di luar area
            window.onclick = function(event) {
                if (event.target === disputeModal) {
                    disputeModal.style.display = "none";
                }
                if (event.target === notificationModal) {
                    notificationModal.style.display = "none";
                }
            };
        });
    </script>
</body>
</html>